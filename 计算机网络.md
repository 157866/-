# 计算机组成原理




## 第一章



### 1.1 什么是Internet？

#### 什么是互联网设备

- 传统PC

- 手机

- 连网手表

- 汽车

- TV



#### 什么是Internet  

> 从硬件具体构成的角度

- 数亿亿计的互联网计算设备

  - 主机 = 端系统
  - 运行网络应用程序

- 通信链路

  - 光纤，同轴链路，无线卫星
  - 传输速率 = 宽带（bps）

- 分组交换设备

  - packets
  - 路由
  - 交换机

  

> 从概念具体的构成角度

- 协议控制发送、接收消息 
  - 如TCP、IP、HTTP、FTP、 PPP

- Internet：“网络的网络”
  - 松散的层次结构，互连的ISP
  - 公共Internet vs. 专用intranet（局域网）
- Internet标准
  - RFC: Request for comments
  - IETF: Internet Engineering Task Force



> 从服务的角度

- 使用通信设施进行通信的**分布式应用**
  - Web、VoIP、email、分布式游戏、电子商务、社交网络 …...
- **通信基础设施为apps提供编程接口（通信服务）**
  - 将发送和接收数据的apps与互联网连接起来
  - 为app应用提供服务选择，类似于邮政服务：
    - 无连接不可靠服务
    - 面向连接的可靠服务



#### 什么是协议

- 人类的协议

  - 几点了？
  - 我有个问题？

  … 发送特定的消息 

  … 收到消息时采取的特定

  行动或其他事件

- 网络协议

  - 类似人类协议
  - 机器之间的协议而非人与人之间的协议
  - Internet 中所有的通信行为都受协议制约

协议定义了在两个或多个通信实体之间交换的**报文格式和次序**，以及在报文传输和/或接收或其他事件方面所采取的**动作**



> 人类协议和计算机网络协议示例



<img src=".\imgs\image-20240122200044504.png" alt="image-20240122200044504" />



### 1.2 网络边缘



#### 网络结构

- 网络边缘 （edge）
  - 主机
  - 应用程序（客户端和服务器）
- 网络核心： （core）
  - 互连着的路由器
  - 网络的网络
- 接入网、物理媒体：（access）
  - 有线或者无线通信链路



> 网络边缘



- 端系统（主机）：
  - 运行应用程序
  - 运行应用程序
  - 在 “网络的边缘”
- 客户/服务器模式
  - 客户端向服务器请求、接收服务
  - 如Web浏览器/服务器；email 客户端/服务器
- 对等（peer-peer ）模式
  - 很少（甚至没有）专门的服务器
  - 如 Gnutella、KaZaA、Emule

#### 面向连接的服务

目标：

> 在端系统之间传输数据

握手：

> 在数据传输之前做好准备（连接建议状态）



TCP(Transmission Control protocol)

> internet 上面向连接服务

- 可靠的，按照顺序地传送数据
  - 可以重传
- 流量控制
  - 发送方不会淹没接收方的数据
- 拥塞控制
  - 当网络拥塞时，发送方降低发送频率

TCP应用

- 文件传送 FTP
- 远程登录 Telnet



#### 无连接的服务

目标:

> 在端系统之间传输数据



UDP(user datagram protocol)

- 无连接
- 不可靠数据流
- 无浏览控制
- 无拥塞控制



UPD应用

- 远程会议
- Internet 电话
- DNS
- 流媒体



### 1.3网络核心

网络核心：

> 路由器的网状网络

基础问题：数据怎样 通过网络进行传输？

- 电路交换
  - 为每个呼叫预留一条专有电路：如电话网
- 分组交换、
  - 将要传送的数据分成一个一个单位：分组
  - 将分组从一个路由传到相邻的路由器（hop），一段段最终从源端到目标端
  - 每段；采用链路的最大传输能力（带宽）

> 网络分类

<img src=".\imgs\image-20240206155851210.png" alt="image-20240206155851210" />





##### 电路交换

> 端到端的资源被分配给从源端到目标端的呼叫 call



<img src=".\imgs\image-20240205115118926.png" alt="image-20240205115118926" />



如图 ： 每段链路有四条线路： 该呼叫采用了上面链路的第二个线路，右边线路的第一个线路（piece）

- 独享资料：不同享
  - 每个呼叫一旦建立起来就能保证性能
- 如果呼叫没有数据发送，被分配的资源就会被浪费（no sharing）
- 通信被传统电话网络采用



> 电路交换特点

- 链路带宽，交换能力
- 专用资源：不能共享
- 保证性能
- 要求建立呼叫连接
- 为呼叫分配片
- 如果某个呼叫没有数据则资源片处于空闲状态（不共享）
- 会将带宽分成片
  - 频发
  - 时分
  - 波分



###### 电路交换：FDM与TDM



<img src=".\imgs\image-20240206145456605.png" alt="image-20240206145456605" />



> 电路交换不适合计算机之间的通信

- 连接建立时间长
- 计算机之间的通信有突发性，如果使用线路交换，则浪费的片较多
  - 即使这个呼叫没有数据传递，其所占据的片也不能够被别的呼叫使用
- 可靠性不高



##### 分组交换

> 以分组为单位存储-转发方式，资源共享按需使用

- 网络带宽资源不再分分为一个个片，传输时使用全部带宽
- 主机之间传输的数据被分为一个个分组
- 存储-转发：分组每次移动一跳（ hop ）
  - 在转发之前，节点必须收到整个分组
  - 延迟比线路交换要大
  - 排队时间



###### 分组交换：存储和转发

<img src=".\imgs\image-20240206150956310.png" alt="image-20240206150956310" />

- 被传输到下一个链路之前，整个分组必须到达路由器：存储-转发
- 在一个速率为R bps的链路，一个长度为L bits 的分组的存储转发延时： L/R s
  - L = 7.5 Mbits
  - R = 1.5 Mbps
  - 3  次存储转发的延时 = 15 s



###### 分组交换： 数据报和虚电路

> 分组交换: 分组的存储转发一段一段从源端传到目标端，按照有无网络层的连接，分成：

- 数据报网络：
  - 分组的目标地址决定下一跳
  - 在不同的阶段，路由可以改变
  - 类似：问路
  - Internent
- 虚电路网络：
  - 每个分组都带标签（虚电路标识 VC ID），标签决定下一跳
  - 在呼叫建立时决定路径，在整个呼叫中路径保持不变
  - 路由器维持每个呼叫的状态信息
  - X.25 和ATM



> 数据报的工作原理

- 通信方式：
  - 数据报网络采用分组交换的方式,每次通信只发送较小的分组,每个分组都附有源地址和目的地址信息。路由器根据分组头中的地址信息独立地将每个分组送达目的地。
- 资源分配:
  - 数据报网络中,每个分组独立传输,不占用网络资源。只有在实际传输数据时网络资源才会被短暂占用。
- 适用场景
  - 数据报网络更适用于不确定通信量的场景,如Internet。它利用分组技术提高网络利用率





> 虚电路的工作原理

<img src=".\imgs\image-20240206155710829.png" alt="image-20240206155710829" />

- 通信方式
  - 虚电路网络采用电路交换的方式,在通信开始前需要先建立一个虚电路,将源和目的地连接起来,然后数据就通过预先建立的通道传输,中间不再需要地址信息。
- 资源分配:
  - 虚电路网络需要在通信开始前预先向网络申请和占用一定的带宽资源,通信过程中这部分资源被专用连接源目标节点,其他节点无法共享这部分资源
- 适用场景:
  - 虚电路网络更适用于通信量大、对时延要求较高的场景,如视频会议。它通过预先建立通道提高传输效率。





###### 分组交换： 排队延迟和丢失

- **如果到达速率>链路的输出速率:** 
  - 分组将会排队，等待传输 
  - 如果路由器的缓存用完了，分组将会被抛弃



###### 网络核心的关键功能

​                                          路由算法                                                                               *转发*

<img src=".\imgs\image-20240206153707748.png" alt="image-20240206153707748" />

> 路由： 决定分组采用的源到目标的路径



> 转发: 将分组从路由器的输入链路转移到输出链路







### 1.4 接入网和物理媒体

> 怎样将端系统和边缘路由器连接？



- 住宅接入网络
- 单位接入网络 （学校、公司）
-  无线接入网络



**注意：**

- 接入网络的带宽 (bits persecond) ？

- 共享/专用？

  

  

  > 个人觉得Java开发不需要太深入了解这个 简写





### 1.5 internet结构和ISP

- 端系统通过接入ISPs (Internet Service Providers)连接到互联网 
  - 住宅，公司和大学的ISPs 、
- 接入ISPs相应的必须是互联的 
  - 因此任何2个端系统可相互发送分组到对方 
- 导致的“网络的网络”非常复杂
  - 发展和演化是通过经济的和国家的政策来驱动的  



 让我们采用渐进方法来描述当前互联网的结构

> 问题： 给定数百万接入ISPs，如何将它们互联到一起？

<img src=".\imgs\image-20240207154117627.png" alt="image-20240207154117627" />



> 如果将每两个ISPs直接连接不可扩展需要O(N²)

<img src=".\imgs\image-20240207154154513.png" alt="image-20240207154154513" />





>  将每个接入ISP都连接到全局ISP（全局范围内覆盖）？客户ISPs和提供者ISPs有经济合约 
>
> 个人认为大多数解决的方案就是加一层

<img src=".\imgs\image-20240207154425751.png" alt="image-20240207154425751" />



> 但是，如果全局ISP是可行的业务，那会有竞争者有利可图，一定会有竞争
>
> 比如：中国移动 联通 电信



<img src=".\imgs\image-20240207154625858.png" alt="image-20240207154625858" />



> 竞争：但如果全局ISP是有利可为的业务，那会有竞争者
>
> 合作：通过ISP之间的合作可以完成业务的扩展，肯定会有互联，对等互联的结算关系



<img src=".\imgs\image-20240207154813505.png" alt="image-20240207154813505" />

> …然后业务会细分（全球接入和区域接入），区域网络将出现，用与将接入ISPs连接到全局ISPs

<img src=".\imgs\image-20240207154931985.png" alt="image-20240207154931985" />

> 然 后 内 容 提 供 商 网 络 (Internet Content Providers,e.g., Google,
>
> Microsoft, Akamai) 可能会构建它们自己的网络，将它们的服务、内容更                         
>
> 加靠近端用户，向用户提供更好的服务,减少自己的运营支出

<img src=".\imgs\image-20240207155035534.png" alt="image-20240207155035534" />



### 1.6分组延迟，丢失和吞吐量



#### 1.6.1分组丢失和延迟是怎么发生的？

在路由器缓冲区的分组队列

- 分组到达链路的速率超过了链路输出的能力
- 分组等待排到队头、被传输

<img src=".\imgs\image-20240207155604822.png" alt="image-20240207155604822" />





#### 1.6.2 四种分组延迟

##### 1. 节点处理延迟

- 检查 bit级差错
- 检查分组首部和决定将分组导向何处



##### 2.排队延迟

- 在输出链路上等待传输的时间
- 依赖于路由器的拥塞程度



##### 3. 传输延迟

- R=链路带宽(bps)
- L=分组长度(bits)
- 将分组发送到链路上的时间= L/R
- 存储转发延时

##### 4.传播延迟

-  d = 物理链路的长度
- s = 在媒体上的传播速度(~2x108 m/sec)
- 传播延时 = d/s



#### 1.6.3 分组丢失

- 链路的队列缓冲区容量有限
- 当分组到达一个满的队列时，该分组将会丢失
- 丢失的分组可能会被前一个节点或源端系统重传，或根本不重传

<img src=".\imgs\image-20240207160240826.png" alt="image-20240207160240826" />



#### 1.6.4 吞吐量

- *吞吐量:* 在源端和目标端之间传输的速率（数据量/单位时间）

  - *瞬间吞吐量:* 在一个时间点的速率
  - *平均吞吐量:* 在一个长时间内平均值

  > 注意： 吞吐量应该是看最小的吞吐量  木桶效应



<img src=".\imgs\image-20240207160412183.png" alt="image-20240207160412183" />





### 1.7协议层次及服务层次

> 问题是： 如何组织和实现这个复杂的网络功能？

网络是一个复杂的系统! 

- 网络功能繁杂：数字信号的物理信号承载、点到点、路由、rdt、进程区分、应用等
- 现实来看，网络的许多构成元素和设备:
  - 主机
  - 路由器
  - 各种媒体的链路
  - 应用
  - 协议
  - 硬件, 软件



#### 服务和服务访问点

- 服务( Service)：低层实体向上层实体提供它们之间的通信的能力
  - 服务用户(service user)
  - 服务提供者(service provider )
- 原语(primitive)：上层使用下层服务的形式，高层使用低层提供的服务，以及低层向高层提供服务都是通过服务访问原语来进行交互的---形式
- 服务访问点 SAP (Services Access Point) ：上层使用下层提供的服务通过层间的接口—地点；
  - 例子:邮箱
  - 地址(address)：下层的一个实体支撑着上层的多个实体，SAP有标志不同上层实体的作用
  - 可以有不同的实现，队列
  - 例子:传输层的SAP: 端口(port)

#### 服务的类型

> 面向连接的服务和无连接的服务-方式



- 面向连接的服务( Connection-oriented Service)

  - **连接**(Connection)：两个通信实体为进行通信而建立的一种结合

  - 面向连接的服务通信的过程：建立连接，通信，拆除连接

  - 适用范围：对于大的数据块要传输; 不适合小的零星报文 

  - 面向连接的服务的例子：网络层的连接被成为虚电路

  - 特点：保序

  - 服务类型:

    - 可靠的信息流 传送页面(可靠的获得,通过接收方的确认)
    - 可靠的字节流 远程登录

    

- 无连接的服务(Connectionless Service)

  - 无连接服务：两个对等层实体在通信前不需要建立一个连接，不预留资源；不需要通信双方都是活跃；(例：寄信)
  - 特点：不可靠、可能重复、可能失序
  - IP分组，数据包；
  - 适用范围：适合传送零星数据；
  - 服务类型：
    - 不可靠的数据报 电子方式的函件
    - 有确认的数据报 挂号信
    - 请求回答 信息查询



#### 服务和协议

- 服务与协议的区别
  - 服务(Service)：低层实体向上层实体提供它们之间的通信的能力，是通过原语(primitive)来操作的，垂直（垂直是上层服务依赖于下层服务）
  - 协议(protocol) ：对等层实体(peer entity)之间在相互通信的过程中，需要遵循的规则的集合，水平（同层级之间的通信）
- 服务与协议的联系
  - 本层协议的实现要靠下层提供的服务来实现
  - 本层实体通过协议为上层提供更高级的服务



<img src=".\imgs\image-20240207165841061.png" alt="image-20240207165841061" />



#### 数据单元

>  数据单元DU

<img src=".\imgs\image-20240207165806223.png" alt="image-20240207165806223" />

#### Internet 协议栈



<img src=".\imgs\image-20240207170008818.png" alt="image-20240207170008818" />

- 应用层: 网络应用
  - 为人类用户或者其他应用进程提供网络应用服务
  - FTP, SMTP, HTTP,DNS
- 传输层: 主机之间的数据传输
  - 在网络层提供的端到端通信基础上，细分为进程到进程，将不可靠的通信变成可靠地通信
  - TCP, UDP
- 网络层: 为数据报从源到目的选择路由
  - 主机主机之间的通信，端到端通信，不可靠
  - IP, 路由协议
- 链路层: 相邻网络节点间的数据传输
  - 2个相邻2点的通信，点到点通信，可靠或不可靠
  - 点对对协议PPP, 802.11(wifi), Ethernet
- 物理层: 在线路上传送bit 





#### ISO/OSI 参考模型

<img src=".\imgs\image-20240207170307383.png" alt="image-20240207170307383" />

- *表示层:* 允许应用解释传输的数据, e.g., 加密，压缩，机器相关的表示转换
- *会话层:* 数据交换的同步，检查点，恢复
- 互联网协议栈没有这两层!
  - 这些服务，如果需要的话，必须被应用实现
  - 需要吗?



#### 封装和解封装

<img src=".\imgs\image-20240207170454076.png" alt="image-20240207170454076" />



#### 各层次的协议数据单元

- 应用层：报文(message)
- 传输层：报文段(segment)：TCP段，UDP数据报
- 网络层：分组packet（如果无连接方式：数据报datagram）
- 数据链路层：帧(frame)
- 物理层：位(bit)



